<!doctype html>




<html class="theme-next pisces" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Microsoft Yahei:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Java,Struts," />





  <link rel="alternate" href="/atom.xml" title="Sakanoy" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/image/tb.png?v=5.1.0" />






<meta name="description" content="这两天看 Struts 真是看的一脸懵逼，一方面不禁感叹牛人的思想就是超前啊，这篇笔记写的很急，其中的理解可能有些错误，想以后有了深入认识再回来修正的…..不禁感叹 Struts2 与 Struts1 真是天差地别啊…. webwork 真厉害呢…">
<meta name="keywords" content="Java,Struts">
<meta property="og:type" content="article">
<meta property="og:title" content="Struts2学习笔记">
<meta property="og:url" content="https://sakanoy.com/2017/06/07/Struts2学习笔记/index.html">
<meta property="og:site_name" content="Sakanoy">
<meta property="og:description" content="这两天看 Struts 真是看的一脸懵逼，一方面不禁感叹牛人的思想就是超前啊，这篇笔记写的很急，其中的理解可能有些错误，想以后有了深入认识再回来修正的…..不禁感叹 Struts2 与 Struts1 真是天差地别啊…. webwork 真厉害呢…">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://sakanoy.com/image/dev/struts2.jpg">
<meta property="og:updated_time" content="2018-08-25T09:37:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Struts2学习笔记">
<meta name="twitter:description" content="这两天看 Struts 真是看的一脸懵逼，一方面不禁感叹牛人的思想就是超前啊，这篇笔记写的很急，其中的理解可能有些错误，想以后有了深入认识再回来修正的…..不禁感叹 Struts2 与 Struts1 真是天差地别啊…. webwork 真厉害呢…">
<meta name="twitter:image" content="https://sakanoy.com/image/dev/struts2.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://sakanoy.com/2017/06/07/Struts2学习笔记/"/>




<script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-bounce.css">

  <title> Struts2学习笔记 | Sakanoy </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-77463916-1', 'auto');
  ga('send', 'pageview');
</script>










  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sakanoy</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">立于浮华之世,奏响天籁之音.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-mark">
          <a href="/mark" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-retweet"></i> <br />
            
            笔记本
          </a>
        </li>
      
        
        <li class="menu-item menu-item-books">
          <a href="/books" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            书单
          </a>
        </li>
      
        
        <li class="menu-item menu-item-music">
          <a href="/music" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-music"></i> <br />
            
            音乐台
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://sakanoy.com/2017/06/07/Struts2学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kerronex">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/image/tx.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sakanoy">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Struts2学习笔记
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-07T14:28:06+00:00">
                2017-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-eye"></i> 热度
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  6,250
                </span>
              

              

              
            </span>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <div style="display: none;color: #999" class="note warning" id='timeliness'></div>
        <script language=javascript>
          var days = (new Date().getTime() - 1496845686000) / 86400000;
          if(days > 180) {
            var infoDom = document.getElementById("timeliness");
            infoDom.innerHTML = "提醒：本文发布于 " + Math.round(days) + " 天前，文中所描述的信息可能已发生改变，请谨慎使用。";
            infoDom.style.display = "block"
          }
        </script>
        <p>这两天看 Struts 真是看的一脸懵逼，一方面不禁感叹牛人的思想就是超前啊，这篇笔记写的很急，其中的理解可能有些错误，想以后有了深入认识再回来修正的…..<br>不禁感叹 Struts2 与 Struts1 真是天差地别啊…. webwork 真厉害呢…<a id="more"></a></p>
<h2 id="Struts1和Struts2"><a href="#Struts1和Struts2" class="headerlink" title="Struts1和Struts2"></a>Struts1和Struts2</h2><p>这个网上随便一搜就有N多的文章，分析的都挺详细的，我呢就说说主要的（<del>我知道的</del>）几点<br>关于 Struts1 我也写了一篇，不过没放在博客上，因为毕竟现在基本已经没人用了啊…..<br>地址在这：<a href="https://github.com/bfchengnuo/MyRecord/blob/master/%E7%AC%94%E8%AE%B0/Struts1%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0.md" target="_blank" rel="noopener">Github</a></p>
<h3 id="Struts1-基于Servlet"><a href="#Struts1-基于Servlet" class="headerlink" title="Struts1-基于Servlet"></a>Struts1-基于Servlet</h3><p>为什么会被淘汰，这当然是因为有缺点的，抛开它奇葩的命名不说，重要的是架构不是很好，体现在下面的几点</p>
<ul>
<li><strong>ActionServlet 的任务过于集中，压力大，不容易扩展和维护</strong><br>它主要做的有：处理请求、实例化 formBean，往里封装数据、然后根据配置文件决定是否进行校验，对结果进行处理，最终把结果封装到 request 中、实例化相应的 Action ，调用相应的方法，传递相关的对象、对 Action 返回的结果进行处理,如转发到指定页面…..;<br>如此多的功能集中在一起必然扩展性很差，也容易出问题</li>
<li><strong>Action 是单例的，线程不安全的</strong><br>Action 被创建出来后会一直存在，并且只存在一个，就像 Servlet，一个 Action 处理所有的请求（数据不安全，不要在 Action 中声明实例变量）</li>
<li><strong>ActionForm 造成类的爆炸</strong><br>因为一个表单就对应一个，虽然可以使用动态 formbean ；一个用户（请求）可能对应好几个…因为 formBean 是随 Action 存在的，一个 Action 可能会处理多个表单</li>
<li><strong>耦合性高</strong><br>从 <code>execute(ActionMapping mapping,ActionForm form,HttpServletRequest request, HttpServletResponse response)</code> 这个从方法的参数就可以看出，需要传入四个参数呐！</li>
</ul>
<h3 id="Struts2-基于Filter"><a href="#Struts2-基于Filter" class="headerlink" title="Struts2-基于Filter"></a>Struts2-基于Filter</h3><p>新一代，然而和一代并没多大关系，倒是和 webwork 的关系挺大</p>
<ul>
<li><strong>分离关注思想</strong><br>和 aop 挺像，嗯？反正就是不像一代那样集中在一个组件上了；将 web 开发中的常规任务剥离开来，分别交给不同的组件（拦截器）进行处理，比如：文件上传、表单的处理、国际化、参数传递、类型转换等等</li>
<li><strong>Action 是原型、独占的，不共享</strong><br>意思就是说一个请求对应一个 Action，所以可以存放客户端的状态信息了！</li>
<li><strong>取消了 ActionForm ，使用 pojo（action、javabean）接收数据</strong></li>
<li><strong>松耦合，可维护性高</strong><br>action 就是个普通的 pojo 也就是普通的 javabean，也就是说 struts2 api 和 原生的 servlet api 关系不大【非侵入性，不用实现你的接口也不用继承你的类，这是理想条件下】</li>
</ul>
<h2 id="Struts2的使用"><a href="#Struts2的使用" class="headerlink" title="Struts2的使用"></a>Struts2的使用</h2><p>搭建就不说了，就是拷进去相应的 jar包，创建的 action 不需要继承任何类或者实现任何的接口<br>下面说下配置，Struts2 是基于过滤器的，所以需要在 <strong>web.xml</strong> 文件里配一个过滤所有请求的过滤器，我用 IDEA 建了个项目，发现都给配好了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>先来写个简单的 Action，相比 Struts1 就简单多了，不需要继承任何类，方法名默认还是用 execute （应该是 webWork 规定的）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 每一次请求都会实例化哦</span></span><br><span class="line">        System.out.println(<span class="string">"实例化啦！！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello World"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>; <span class="comment">// 不进行任何跳转；返回值也叫做路由串</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后是 Struts 的配置文件，默认在 src 下名字为 <strong>struts.xml</strong> ；至于这个文件怎么写，不知道，那就抄吧，在 Struts 的核心包里有相关的配置文件，照着写写就差不多（<strong>struts2-core.jar</strong> 下的 <strong>struts-default.xml</strong> 有返回值等大部分配置；<strong>struts2-core.jar/org.apache.struts2/default.properties</strong> 文件下有绝大部分的变量说明）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">        "http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置常量，这个是设置请求后缀的，默认是 .action ；最后的 “,,” 表示结尾空也可以 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.action.extension"</span> <span class="attr">value</span>=<span class="string">"do,,"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置开发模式，可以自动重新加载国际化资源文件和配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--可以继承，它配置了很多默认值，如 type 等--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"HelloWorld"</span> <span class="attr">namespace</span>=<span class="string">"/one"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置默认的 action 也就是在当前的命名空间下，如果找不到 action 的时候访问这个--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default-action-ref</span> <span class="attr">name</span>=<span class="string">"HelloWorldAction"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--设置默认的 class 引用，也就是 action 可以不用配 class 了--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default-class-ref</span> <span class="attr">class</span>=<span class="string">"com.bfchengnuo.web.action.HelloWorld"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"HelloWorldAction"</span> <span class="attr">class</span>=<span class="string">"com.bfchengnuo.web.action.HelloWorld"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置返回值相关，name 就是返回值，如果是 success 可以省略--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--父类中指定了默认的 type 为 dispatcher 也就是转发--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"ActionNoClass"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--使用通配符来实现动态方法的调用；避免使用 ！--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"HWAction_*"</span> <span class="attr">class</span>=<span class="string">"com.bfchengnuo.web.action.HelloWorld"</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--每一个返回值对应一个方法--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"save"</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"test"</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>关于 namespace 命名空间的作用，就是在输入网址的时候用的，比如： <code>http://xxx:8080/webAppName/namesPace/Action</code><br>最后配置的那个 action 是动态调用，它对应多个返回值，也就是对应多个方法，可以接受很多的请求，并且使用了通配符，通配符匹配到的会传给后面的 <code>{1}</code> 中，比如这样用：<code>http://xxx:8080/webAppName/namesPace/HWAction_save</code> ；<strong>下划线后面跟的是方法名，如果省略将会匹配默认的 execute 方法</strong></p>
<blockquote>
<p>  对于多个方法的访问，除了写多个 action 外<br>  还可以使用这样的地址访问：<code>http://xxx:8080/webAppName/namesPace/Action!methodName</code><br>  这样的话只需要在 method 里指明方法名就行了，不过用叹号分割总感觉怪怪的，并且在 Struts 的配置文件中<strong>开启动态方法调用</strong>才会生效。所以还是像上面那样配置吧</p>
</blockquote>
<p>上面提到了可以不配 class 走默认设置的全局 class，这个具体是应用在请求 WEB-INF 目录下的文件的，因为默认的 class 是 ActionSupport ，它实现了 Action 的接口，所有有一个 execute 方法，这个方法返回字符串 success，所以说只需要配置：<code>&lt;result name=&quot;success&quot;&gt;/WEB-INF/index.jsp&lt;/result&gt;</code> 就可以实现请求保护目录下的文件，而不需要写相应的 Action</p>
<h3 id="获取参数"><a href="#获取参数" class="headerlink" title="获取参数"></a>获取参数</h3><p>url 可以传参，但是 action 中并没有继承任何类，如何获取 request 等对象呢，是通过 ServletActionContext 的静态方法获取的；但是获取 url 中的值并不需要这么麻烦，前面说过，action 其实就是一个 javabean，那么就可以设置属性，属性名对应传进来的参数名，调用的时候会自动用反射技术进行设置的；所以说在方法中直接用就行了<br>如果需要数据回显，还是用标签库（其实是从值栈中获取）：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;测试页&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    这是一个测试页面</span><br><span class="line">    name:&lt;s:property value=<span class="string">"name"</span>/&gt; &lt;br&gt;</span><br><span class="line">    age:&lt;s:property value=<span class="string">"age"</span>/&gt; &lt;br&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>再来说说 ServletActionContext ，它可以获取到绝大数需要的对象，它其实是 ActionContext 的孩子，下面会详细说</p>
<h3 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h3><p>我们知道开发的 web 应用中存储数据有四个域，从小到大依次是：page 、 request 、 session 、 application</p>
<p>在 struts 有个比较常用的是 ActionContext 说到 Context 也就是上下文，指的其实就是环境，也就是当前的环境，同时还可以说是数据中心<br>在 ActionContext 中封装了其他域的引用，具体有：</p>
<ol>
<li>request</li>
<li>session</li>
<li>application</li>
<li>valuestack(值栈)<br>值栈肯定是个栈，然而其实是通过 arrayList 进行模拟的；值栈其实存在于 request 一个特殊的属性 <strong>struts.ValueStak</strong> 独立出来是为了方便<br><strong>s:property</strong> 标签默认就是去值栈里进行寻找</li>
<li>parameters</li>
<li>attr<br>会自动从 session/request/application 域中去寻找</li>
</ol>
<p>ActionContext  于内部的六个“域”是<strong>双向引用</strong>！<strong>ActionContext 属于 threadlocal 俗称线程本地化</strong>；ServletActionContext 是 ActionContext 的子类，进行了一些简单的封装；所以有了很多的 get 的方法获取到相应的<strong>对象</strong><br><strong>通常还是推荐尽量使用 ActionContext 来获取数据，因为获取的是 Map 集合，不需要加入 servlet API 的 jar 包，也就是说解耦了；但是有些功能实现不了的话还是需要用 servlet 中的对象（比如获取路径）</strong><br>另外，ActionContext  还可以这样用：<code>Map&lt;K,V&gt; map = ActionContext.get(&quot;request&quot;)</code> 这样获取到的是 request 的 Map 集合</p>
<blockquote>
<p>  ActionContext 的 put 方法默认是直接存到 request 域<br>  get(“request”).put 方式是存到 request 的 map 集合中去<br>  所以说，在用 OGNL 表达式取的时候，第一种可以直接 <code>#key</code> 这样取；而第二种要使用 <code>#request.key</code> 或者 <code>#attr.key</code> 的方式来取值</p>
<p>  put 方法像是 Struts 的一种优化，为了方便取值，因为值栈说白了就是存在于 request 域中的</p>
</blockquote>
<p>通常，Action 会被放在值栈根节点的栈顶（双向引用哦），这个操作是在执行过程中执行的（下面的工作原理），表单的提交、数据的回显都是依赖于值栈</p>
<hr>
<p>然后再说下属性链，Action 其实是个 javabean，在 Action 中还可以再引用一个 bean 作为属性，传参的时候就需要指明了：<br><code>http://xxx:8080/webName/action?user.name=loli</code> 这就是给 action 中的 user 属性的 name 属性赋值，额…说的这么别扭<br><div class="note warning"><p>这里有个坑，当你在 action 用 javabean 类型的属性时，千万别用一个小写字母开头，比如：mUser<br>因为这样在生成属性的时候会变成这样：getMUser() ；这就很尴尬了….这是不符合规范的，所以，别这么搞</p>
</div></p>
<p>补充一个专业术语：<strong>action 相关</strong><br>说的是很多资源文件需要<strong>和 action 放在一起，文件名相同，扩展名不同</strong>，至于什么用处，相当于一代的国际化资源文件吧，下面的表单校验中用得到</p>
<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p><img src="/image/dev/struts2.jpg" alt="struts2.jpg"></p>
<p>图画的不是很准确，差不多这意思，请求来了都要进入 StrutsPreparreAndExecuteFilter 这个核心过滤器，StrutsPreparreAndExecuteFilter 主要有两个操作（对象），一个是准备（prepare 图的右边）；另一个是执行（excute 图的左边）；<br>prepare 会注册国际化资源文件，并且会创建 ActionContext 对象，顺便绑定到当前线程中去….(创建的过程还是蛮复杂的，想知道的看源码….)<br>接下来会查找 ActionMapping，如果没有就创建（<strong>通过 ActionMapper 来寻找/创建</strong>），最后存到 request 中去<br>另外还会参与过滤模式的处理，就是过滤出 Action 的请求，其他的请求（jsp、img等）直接放行</p>
<blockquote>
<p>  在核心过滤器中，会发现刚开始是加载配置文件，如果没有特别的指定会自动加载3个配置文件，第一个是 Struts2 核心包下的 struts-default.xml 文件，最后一个是我们自己配置的 struts.xml 文件<br>  struts-default.xml 文件里配了一些东西，比如刚开始的一堆 bean，后面就是定义了一些 Type（result-types）比如最常用的 dispatcher 和 redirect，其中可以看到 dispatcher 被设置为了默认，所以在我们自己配的配置文件中如果设置转发不需要配 Type<br>  再下面就是初始化拦截器（拦截器只能拦截 Action，是 Struts 中的概念），这应该就是 Struts2 的核心了；定义默认的拦截器、默认执行的 Action</p>
</blockquote>
<hr>
<p>上面的操作完成后最终会到达 excute；判断如果 mapping 不为空，就调用 excute 执行 Action 会把 mapping 一起传过去，执行玩后到此终止，也就是说它没放行，<strong>后面的过滤器不会自动执行！</strong><br>在调用 Action 的方法中 excute 会创建出 ActionProxy ，它依赖于 ConfigurationManager 把配置文件（Struts.xml）读取出来进行一些处理，然后会请求一个中间人（Action Invocation）来调用那 N 个过滤器（应该是13个，具体看配置文件，叫做过滤器栈），使用的是递归方式，也就是上图的虚线，调用 1 然后返回（返回时再次调用此方法，也就是调用第二个拦截器），再继续调用 2 再返回….<br>在 Action 调用之前处理的叫预处理，之后处理的叫后处理，大部分后处理是空实现，文件上传的过滤器比较特殊，因为需要在后处理里删除缓存文件</p>
<p>应该是在调用拦截器之前 excute 会把 action 置为栈顶（值栈）</p>
<p><strong>如果配置自己的拦截器，一定要放在 Struts 拦截器的上面，因为 Struts 拦截器并不会放行</strong></p>
<h2 id="其他拓展"><a href="#其他拓展" class="headerlink" title="其他拓展"></a>其他拓展</h2><h3 id="ActionSupport"><a href="#ActionSupport" class="headerlink" title="ActionSupport"></a>ActionSupport</h3><p>这个类实现了 action 和其他几个有用的接口，比如数据的校验、国际化；你的 action 继承它后会自动获得这些能力</p>
<h3 id="基本校验-amp-文件上传"><a href="#基本校验-amp-文件上传" class="headerlink" title="基本校验&amp;文件上传"></a>基本校验&amp;文件上传</h3><p>主要是通过拦截器和接口实现的 ActionSupport 实现了两个接口和默认栈中一个拦截器配合使用<br>DefaultWorkflowInterceptor 提供了基本的校验功能（其实它只是判断是否有错误，有就跳转到 input 设定的页面，而不会再执行 Action 了）<br>关键的<strong>调用</strong>在校验拦截器；<del>所以 DefaultWorkflowInterceptor 就是工作流嘛，应该可以理解为重新定义路由….额</del></p>
<p>先来写个注册页面，使用到了标签库，很贴心的会自动显示校验错误，不需要任何标签：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;注册的测试页&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    这是一个测试页面 &lt;br&gt;</span><br><span class="line">    &lt;s:form namespace=<span class="string">"/reg"</span> action=<span class="string">"RegAction_reg"</span> method=<span class="string">"POST"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">        &lt;s:textfield name=<span class="string">"name"</span> label=<span class="string">"用户名"</span>/&gt;</span><br><span class="line">        &lt;s:textfield name=<span class="string">"age"</span> label=<span class="string">"年龄"</span>/&gt;</span><br><span class="line">        &lt;s:file name=<span class="string">"img"</span> label=<span class="string">"上传文件"</span>/&gt;</span><br><span class="line">        &lt;s:submit value=<span class="string">"提交"</span>/&gt;</span><br><span class="line">    &lt;/s:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>为了兼容直接访问 JSP 的情况（虽然极少）最好把 namespace 写上，这里顺便使用了文件上传的过滤器，文件的信息会自动装填到相应的字段，比如文件的类型会自动装填到下面的 imgContentType 字段，类型是 MIME 的，在服务器的 web.xml 中有相应的定义，相应处理请求的 Action ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上传文件相关，以及获取的文件名和类型</span></span><br><span class="line">    <span class="keyword">private</span> File img;</span><br><span class="line">    <span class="keyword">private</span> String imgFileName;</span><br><span class="line">    <span class="keyword">private</span> String imgContentType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 到达注册页面,本方法不应该被校验</span></span><br><span class="line">    <span class="meta">@SkipValidation</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toReg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"regView"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">reg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取上传的文件</span></span><br><span class="line">        String dir = ServletActionContext.getServletContext().getRealPath(<span class="string">"/upload"</span>);</span><br><span class="line">        System.out.println(dir);</span><br><span class="line">        String ext = imgFileName.substring(imgFileName.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">        <span class="keyword">long</span> l = System.nanoTime();</span><br><span class="line"></span><br><span class="line">        File file = <span class="keyword">new</span> File(dir, l + ext);</span><br><span class="line">        <span class="comment">// 或者使用 FileUtils.copyFile(a,b);</span></span><br><span class="line">        img.renameTo(file);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (name == <span class="keyword">null</span> || name.isEmpty()) &#123;</span><br><span class="line">            addFieldError(<span class="string">"name"</span>,getText(<span class="string">"error.name.empty"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(String age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> img;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImg</span><span class="params">(File img)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.img = img;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getImgFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> imgFileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImgFileName</span><span class="params">(String imgFileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.imgFileName = imgFileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getImgContentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> imgContentType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImgContentType</span><span class="params">(String imgContentType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.imgContentType = imgContentType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Action 中，validate 校验方法优先于其他方法执行，但是校验过滤器是在参数过滤器之后的，没有参数校什么校；相应的配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"regPkg"</span> <span class="attr">namespace</span>=<span class="string">"/reg"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"RegAction_*"</span> <span class="attr">class</span>=<span class="string">"com.bfchengnuo.web.action.RegAction"</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/reg/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/reg/error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 校验失败自动跳回的路由 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/reg/reg.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"regView"</span>&gt;</span>/reg/reg.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>  关于 addFieldError 方法，它是先由校验拦截器调用的，然后才是 DefaultWorkflowInterceptor 进行判断，就是判断是否有错误消息啦；如果有就路由到 input 设置的界面了<br>  addFieldError 方法会将错误信息加入到一个 Map 集合中去，然后在后续的 JSP 页面中就可以从这个集合中取出这些信息</p>
</blockquote>
<p>关于配置文件，可以采用模块化思想，就是有多份文件，在主文件中使用 include 引用；</p>
<h3 id="校验-amp-文件上传的补充"><a href="#校验-amp-文件上传的补充" class="headerlink" title="校验&amp;文件上传的补充"></a>校验&amp;文件上传的补充</h3><p>上面使用的注解的方式避免 toReg 方法被校验，这种方法只限于在这个环境（拦截器）下使用；除了这一种还有其他两种方式，并且这两种方式是通用的，在其他的拦截器也可以使用</p>
<ul>
<li><p>加后缀法指定校验方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 看方法名，后面跟需要校验的方法名，或者使用 validateDoReg 也可以</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validateReg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name == <span class="keyword">null</span> || name.isEmpty()) &#123;</span><br><span class="line">        addFieldError(<span class="string">"name"</span>,getText(<span class="string">"error.name.empty"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件法：在需要处理的 Action 下覆盖默认的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 去校验的第三种方式：覆盖法指定跳过的方法，这个写法在配置文件中也可以找到 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"validation.excludeMethods"</span>&gt;</span>input,back,cancel,toReg<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<p>在文件上传的时候，我们可能要限制文件上传的大小，这个在 Struts 的配置文件中设置下 <code>struts.multipart.maxSize</code> 的值就可以了<br>还比较常用的是限制文件类型，也就是指定某些类型的文件才能上传，这个用 fileUpload 拦截器就可以做到，这种方式类似是注入了，可以找到其类中具体对应的属性，具体配置是：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 覆盖原拦截器的属性 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- allowedTypes 就是设置限制的 MIME 了，更严格 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fileUpload.allowedExtensions"</span>&gt;</span>txt,jpg,jpeg<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里提一下，一旦配置了 Action 的拦截器（interceptor-ref）就不会继承包配置的默认的拦截器栈了，所以如果配置其他的拦截器别忘了加入 defaultStack</p>
<p>这些内容在测试代码中都有，还有文件的下载，篇幅太长就不写了，详见 <a href="https://github.com/bfchengnuo/java_learn/blob/master/XC/Struts2/bfchengnuo/web/action/FileAction.java" target="_blank" rel="noopener">Github</a></p>
<h3 id="使用验证框架"><a href="#使用验证框架" class="headerlink" title="使用验证框架"></a>使用验证框架</h3><p>上面所写的是实现 validate 方法，其实还可以用 Struts2 提供的框架，配置下 xml 文件就行了，具体的约束在：<code>lib/xwork-core.jar!/xwork-validator-1.0.2.dtd</code> ；嗯….是的，在 xwork 下</p>
<p>然后创建 Action 相关文件，在需要进行校验的 Action，名字类似：<code>ValidateAction-validation.xml</code> ；其他的都一样，都是用 ValidationAware 接口存储错误信息，用 workflow 拦截器导向 input 界面，一个例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE validators PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Apache Struts//XWork Validator 1.0.2//EN"</span></span><br><span class="line"><span class="meta">        "http://struts.apache.org/dtds/xwork-validator-1.0.2.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span>&gt;</span>用户名不能为空<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"stringlength"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"minLength"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"maxLength"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span>&gt;</span>name:$&#123;name&#125; 必须 $&#123;minLength&#125; - $&#123;maxLength&#125;<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;field-validator type="email"&gt;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;message&gt;xxxx&lt;/message&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;/field-validator&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"age"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"required"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span>&gt;</span>年龄不能为空<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>12<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>16<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span>&gt;</span>必须 12 - 16<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 使用 OGNL 表达式校验两次密码是否相同 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"expression"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"expression"</span>&gt;</span>pwd==confirmPwd<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span>&gt;</span>两次密码不同<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>msg 可以使用其 key 属性从国际化资源文件中提取，当然在其中也是可以使用 OGNL 的<br>如果验证指定方法文件名就要改成：<code>ClassName-ActionName-validation.xml</code></p>
<h2 id="主题与国际化"><a href="#主题与国际化" class="headerlink" title="主题与国际化"></a>主题与国际化</h2><p>这两方面简单说下吧，我没仔细看呢….Orz<br>struts2 默认带了 4 套主题；可以通过设置常量的方式来指定框架使用那个主题：<code>struts.ui.theme=xhtml</code> ；默认就是 xhtml<br>不同的主题在生成 html 的时候会有所差异。这几个主题什么区别自行搜索吧<br>如果某个标签 Struts 渲染的你不爽，那么是可以修改的，比如说错误的那个标签；因为 JVM 是先加载 jar 包，然后加载 src 里面的代码，如果在 src 里有相同的包，相同的文件，那么就会覆盖之前的（改 ftl 模板文件就行）</p>
<hr>
<p>关于国际化拦截器，他会检测请求是否传入了 <code>request_locale</code> 参数，如果有就将其存储到 session 中，并且更改其对应的语言（就是加载相应的国际化资源文件）并且其实还存了一份到 ActionContext 中，就是那个大 Map，便于数据的回显<br>资源文件按照：<code>文件名_语言_地区</code> 的形式，比如：<code>name_zh_CN</code> ，类型当然是 properties；加载国际化资源使用的是常量的方式，键是 <code>struts.custom.i18n.resources</code> 值就是你写的 prop 文件的位置了，同一类加载一个就行（默认的那个 name.properties），多个用逗号分割；记得在 JSP 的标签中使用 <code>&lt;s:text&gt;</code> 标签的 name 属性获取值</p>
<h2 id="模型驱动拦截器"><a href="#模型驱动拦截器" class="headerlink" title="模型驱动拦截器"></a>模型驱动拦截器</h2><p>也许配合 <a href="https://bfchengnuo.com/2017/06/16/Struts2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BA%8C/">笔记2</a> 效果更好，因为哪一篇太长了（这一篇好像更长了），写在这里了….<br>先说它的作用，其一：<br>OGNL 表达式是从栈顶的对象里找数据，对象里的对象里的值是没办法直接用的，只能使用属性链，使用模型驱动后，会在栈中压入一个自定义的对象，在 Action 的上面，所以在 JSP 中可以直接用这个对象里的属性，表单提交的数据也是进这个对象<br>其二，也是主要作用：<br>对所有的 Action 模型对象进行批处理；比如：在一个可以拦截所有 Action 的拦截器中判断(instanceof)是否是 ModelDriven，如果是就强转成 ModelDriven，调用其 getModel 方法就可以获得其要操作的对象；然后就可以利用反射进行实例化….等</p>
<p>使用模型驱动需要实现接口 <code>ModelDriven&lt;T&gt;</code>,以及实现 getModel 方法，这个方法返回的就是要压入栈顶的那个对象<br>更进一步使用：<br>模型驱动拦截器是在参数拦截器之前的，如果想要在模型驱动将对象压入栈顶之前初始化（填充）对象，可以使用准备拦截器（翻译不是很准确）；需要实现 Preparable 接口，此方法会在模型驱动拦截器之前调用<br>如果需要传进的参数数据，要用 paramsPrepareParamsStack 栈，因为如果用默认栈，准备拦截器是优于参数拦截器的，那样就会取不到参数</p>
<p>具体的测试代码我放在 <a href="https://github.com/bfchengnuo/java_learn/tree/master/XC/Struts2" target="_blank" rel="noopener">Github</a></p>
<h2 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h2><p>发现一个标签对于调试很爽，并且使用简单：<code>&lt;s:debug /&gt;</code><br>加上后会显示一个连接，点击会展示值栈、ActionContext 等的情况</p>
<p>Action 类中，如果加上 <code>private static final long serialVersionUID = 1006766693264599611L;</code> 是反序列化时用的，具体还没研究</p>
<p>关于校验详细的流程写的不太详细，先这样吧….</p>
<hr>
<p>Struts2 的根配置文件除了前面所说的，可能还会用到的有：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span>    </span><br><span class="line">    <span class="comment">&lt;!-- 请求参数的编码方式 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.i18n.encoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 指定被struts2处理的请求后缀类型。多个用逗号隔开 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.action.extension"</span> <span class="attr">value</span>=<span class="string">"action,do,htm"</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 当struts.xml改动后，是否重新加载。默认值为false(生产环境下使用),开发阶段最好打开  --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.configuration.xml.reload"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 是否使用struts的开发模式。开发模式会有更多的调试信息。默认值为false(生产环境下使用),开发阶段最好打开  --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span>    </span><br><span class="line">    <span class="comment">&lt;!-- 设置浏览器是否缓存静态内容。默认值为true(生产环境下使用),开发阶段最好关闭  --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.serve.static.browserCache"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 指定由 spring 负责action对象的创建     </span></span><br><span class="line"><span class="comment">    &lt;constant name="struts.objectFactory" value="spring" /&gt;  </span></span><br><span class="line"><span class="comment">    --&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 是否开启动态方法调用 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.enable.DynamicMethodInvocation"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后补充：关于转发，如果是使用链式（type=chain）转发到另一个 Action，那么它们两个都是在一个线程中</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>喜欢就请我吃包辣条吧！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/image/pay/wx.jpg" alt="Kerronex WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/image/pay/zfb.jpg" alt="Kerronex Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>本文作者：</strong>
      Kerronex
    </li>
    <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://sakanoy.com/2017/06/07/Struts2学习笔记/" title="Struts2学习笔记">https://sakanoy.com/2017/06/07/Struts2学习笔记/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明： </strong>
      本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
    </li>
  </ul>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
          
            <a href="/tags/Struts/" rel="tag"><i class="fa fa-tag"></i> Struts</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/27/CSS3学习笔记-二/" rel="next" title="CSS3学习笔记(二)">
                <i class="fa fa-chevron-left"></i> CSS3学习笔记(二)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/06/16/Struts2学习笔记-二/" rel="prev" title="Struts2学习笔记(二)">
                Struts2学习笔记(二) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        
          <p class="warninginfo">
            <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
              评论框加载失败，无法访问 Disqus<br><br>
              你可能需要魔法上网~~
          </p>

      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/image/tx.png"
               alt="Kerronex" />
          <p class="site-author-name" itemprop="name">Kerronex</p>
           
              <p class="site-description motion-element" itemprop="description">程序猿/二刺螈<br/>夜猫族/爱折腾</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">130</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">75</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="Mailto:bfchengnuo@gmail.com" target="_blank" title="Email">
                  
                    <i class="fa fa-fw fa-envelope-o"></i>
                  
                  Email
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://GitHub.com/bfchengnuo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://sakanoy.com/MyRecord/#/" target="_blank" title="笔记本">
                  
                    <i class="fa fa-fw fa-book"></i>
                  
                  笔记本
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cnblogs.com/bfchengnuo" target="_blank" title="博客园">
                  
                    <i class="fa fa-fw fa-paw"></i>
                  
                  博客园
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              小伙伴们~
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://heartsky.info" title="HeartSky" target="_blank">HeartSky</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.kiuber.me" title="Kiuber" target="_blank">Kiuber</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/nightcharm" title="夜Charm" target="_blank">夜Charm</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Struts1和Struts2"><span class="nav-number">1.</span> <span class="nav-text">Struts1和Struts2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Struts1-基于Servlet"><span class="nav-number">1.1.</span> <span class="nav-text">Struts1-基于Servlet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Struts2-基于Filter"><span class="nav-number">1.2.</span> <span class="nav-text">Struts2-基于Filter</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Struts2的使用"><span class="nav-number">2.</span> <span class="nav-text">Struts2的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获取参数"><span class="nav-number">2.1.</span> <span class="nav-text">获取参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据处理"><span class="nav-number">2.2.</span> <span class="nav-text">数据处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#工作原理"><span class="nav-number">2.3.</span> <span class="nav-text">工作原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他拓展"><span class="nav-number">3.</span> <span class="nav-text">其他拓展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ActionSupport"><span class="nav-number">3.1.</span> <span class="nav-text">ActionSupport</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基本校验-amp-文件上传"><span class="nav-number">3.2.</span> <span class="nav-text">基本校验&amp;文件上传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#校验-amp-文件上传的补充"><span class="nav-number">3.3.</span> <span class="nav-text">校验&amp;文件上传的补充</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用验证框架"><span class="nav-number">3.4.</span> <span class="nav-text">使用验证框架</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主题与国际化"><span class="nav-number">4.</span> <span class="nav-text">主题与国际化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模型驱动拦截器"><span class="nav-number">5.</span> <span class="nav-text">模型驱动拦截器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他配置"><span class="nav-number">6.</span> <span class="nav-text">其他配置</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>
    <div style="height: 370px;background-image: url(/image/bj.png);background-repeat: no-repeat; margin-left: 31%;"></div>
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
<span id="sitetime"></span>
<span class="my-face">(●'◡'●)ﾉ♥</span>
<script language=javascript>
function siteTime(){
window.setTimeout("siteTime()", 1000);
var seconds = 1000
var minutes = seconds * 60
var hours = minutes * 60
var days = hours * 24
var years = days * 365

var today = new Date()
var todayYear = today.getFullYear()
var todayMonth = today.getMonth()
var todayDate = today.getDate()
var todayHour = today.getHours()
var todayMinute = today.getMinutes()
var todaySecond = today.getSeconds()

/* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳) 
year - 作为date对象的年份，为4位年份值
month - 0-11之间的整数，做为date对象的月份
day - 1-31之间的整数，做为date对象的天数
hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
minutes - 0-59之间的整数，做为date对象的分钟数
seconds - 0-59之间的整数，做为date对象的秒数
microseconds - 0-999之间的整数，做为date对象的毫秒数 */
var t1 = Date.UTC(2016,3,30,8,0,0)
var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond)
var diff = t2-t1

var diffYears = Math.floor(diff/years)
var diffDays = Math.floor((diff/days)-diffYears*365)
var diffDaysAll = Math.floor(diff/days)
var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours)
var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes)
var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds)
document.getElementById("sitetime").innerHTML=" 本站已萌萌哒运行 "+diffDaysAll+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒 "
}
siteTime()
</script>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共521.4k字</span>

</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'bfchengnuo';
      var disqus_identifier = '2017/06/07/Struts2学习笔记/';

      var disqus_title = "Struts2学习笔记";


      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      

      
        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
            this.page.title = disqus_title;
        };
        run_disqus_script('embed.js');
      

    </script>
  













  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":130,"height":170,"hOffset":30,"vOffset":-10},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body>
</html>
