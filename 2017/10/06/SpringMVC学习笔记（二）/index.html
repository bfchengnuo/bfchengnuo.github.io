<!doctype html>




<html class="theme-next pisces" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Microsoft Yahei:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Java,SpringMVC," />





  <link rel="alternate" href="/atom.xml" title="Sakanoy" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/image/tb.png?v=5.1.0" />






<meta name="description" content="接着上一篇来说，这篇包括 RequestMapping 的进一步探索、与 Struts2 的主要区别、为什么用 JSTL、设置 JSON 格式相关、文件上传以及（自定义）拦截器的相关内容。">
<meta name="keywords" content="Java,SpringMVC">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringMVC学习笔记（二）">
<meta property="og:url" content="https://sakanoy.com/2017/10/06/SpringMVC学习笔记（二）/index.html">
<meta property="og:site_name" content="Sakanoy">
<meta property="og:description" content="接着上一篇来说，这篇包括 RequestMapping 的进一步探索、与 Struts2 的主要区别、为什么用 JSTL、设置 JSON 格式相关、文件上传以及（自定义）拦截器的相关内容。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-06-21T11:16:08.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SpringMVC学习笔记（二）">
<meta name="twitter:description" content="接着上一篇来说，这篇包括 RequestMapping 的进一步探索、与 Struts2 的主要区别、为什么用 JSTL、设置 JSON 格式相关、文件上传以及（自定义）拦截器的相关内容。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://sakanoy.com/2017/10/06/SpringMVC学习笔记（二）/"/>




<script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-bounce.css">

  <title> SpringMVC学习笔记（二） | Sakanoy </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-77463916-1', 'auto');
  ga('send', 'pageview');
</script>










  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sakanoy</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">立于浮华之世,奏响天籁之音.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-mark">
          <a href="/mark" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-retweet"></i> <br />
            
            笔记本
          </a>
        </li>
      
        
        <li class="menu-item menu-item-books">
          <a href="/books" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            书单
          </a>
        </li>
      
        
        <li class="menu-item menu-item-music">
          <a href="/music" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-music"></i> <br />
            
            音乐台
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://sakanoy.com/2017/10/06/SpringMVC学习笔记（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kerronex">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/image/tx.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sakanoy">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                SpringMVC学习笔记（二）
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-06T11:27:02+00:00">
                2017-10-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-eye"></i> 热度
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  5,418
                </span>
              

              

              
            </span>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <div style="display: none;color: #999" class="note warning" id='timeliness'></div>
        <script language=javascript>
          var days = (new Date().getTime() - 1507289222000) / 86400000;
          if(days > 180) {
            var infoDom = document.getElementById("timeliness");
            infoDom.innerHTML = "提醒：本文发布于 " + Math.round(days) + " 天前，文中所描述的信息可能已发生改变，请谨慎使用。";
            infoDom.style.display = "block"
          }
        </script>
        <p>接着上一篇来说，这篇包括 RequestMapping 的进一步探索、与 Struts2 的主要区别、为什么用 JSTL、设置 JSON 格式相关、文件上传以及（自定义）拦截器的相关内容。<a id="more"></a><br>相比之下这篇的内容就少了，果然 SpringMVC 是轻量级的原因么，比 Struts 的篇幅要少得多，但依然做到高效开发，有一些源码级别的内容还没深入看，以后慢慢再继续补充。</p>
<h2 id="深入RequestMapping"><a href="#深入RequestMapping" class="headerlink" title="深入RequestMapping"></a>深入RequestMapping</h2><p>都知道它是一个处理请求地址的注解，来研究下当一个方法被 @RequestMapping 标记后（处理器方法），它所支持的方法参数和返回类型。</p>
<h3 id="支持的方法参数"><a href="#支持的方法参数" class="headerlink" title="支持的方法参数"></a>支持的方法参数</h3><ol>
<li>HttpServlet 对象，主要包括 HttpServletRequest 、HttpServletResponse 和 HttpSession 对象。<br>但是有一点需要注意的是在使用 HttpSession 对象的时候，如果此时 HttpSession 对象还没有建立起来的话就会有问题。</li>
<li>Spring 自己的 WebRequest 对象。<br>使用该对象可以访问到存放在 HttpServletRequest 和 HttpSession 中的属性值。</li>
<li>InputStream 、OutputStream 、Reader 和 Writer 。<br>InputStream 和 Reader 是针对 HttpServletRequest 而言的，可以从里面取数据；OutputStream 和 Writer 是针对 HttpServletResponse 而言的，可以往里面写数据。</li>
<li>使用 @PathVariable 、@RequestParam 、@CookieValue 和 @RequestHeader 标记的参数。</li>
<li>使用 @ModelAttribute 标记的参数。</li>
<li>java.util.Map 、Spring 封装的 Model 和 ModelMap 。<br>这些都可以<strong>用来封装模型数据</strong>，用来给视图做展示。</li>
<li>实体类。<br>可以用来接收上传的参数。</li>
<li>Spring 封装的 MultipartFile 。<br>用来接收上传文件的。</li>
<li>Spring 封装的 Errors 和 BindingResult 对象。<br>这两个对象参数必须紧接在需要验证的实体对象参数之后，它里面包含了实体对象的验证结果。</li>
</ol>
<p>仔细看看确实不算少，但大部分都已经看过了。</p>
<h3 id="支持的返回类型"><a href="#支持的返回类型" class="headerlink" title="支持的返回类型"></a>支持的返回类型</h3><ol>
<li>一个包含模型和视图的 ModelAndView 对象。</li>
<li>一个模型对象，这主要包括 Spring 封装好的 Model 和 ModelMap ，以及 java.util.Map ，当没有视图返回的时候视图名称将由 RequestToViewNameTranslator 来决定。</li>
<li>一个 View 对象。<br>这个时候如果在渲染视图的过程中模型的话就可以给处理器方法定义一个模型参数，然后在方法体里面往模型中添加值。</li>
<li>一个 String 字符串。<br>这往往代表的是一个视图名称。这个时候如果在渲染视图的过程中需要模型的话就可以给处理器方法一个模型参数，然后在方法体里面往模型中添加值就可以了。</li>
<li>返回值是 void 。<br>这种情况一般是我们直接把返回结果写到 HttpServletResponse 中了，如果没有写的话，那么Spring 将会利用 RequestToViewNameTranslator 来返回一个对应的视图名称。<br>如果视图中需要模型的话，处理方法与返回字符串的情况相同。</li>
<li>如果处理器方法被注解 @ResponseBody 标记的话，那么处理器方法的任何返回类型都会通过 HttpMessageConverters 转换之后写到 HttpServletResponse 中，而不会像上面的那些情况一样当做视图或者模型来处理。</li>
<li>除以上几种情况之外的其他任何返回类型都会被当做模型中的一个属性来处理；<br>而返回的视图还是由 RequestToViewNameTranslator 来决定，<br>添加到模型中的属性名称可以在该方法上用 @ModelAttribute(“attributeName”) 来定义，否则将使用返回类型的类名称的首字母小写形式来表示。<br>使用 @ModelAttribute 标记的方法会在 @RequestMapping 标记的方法执行之前执行。</li>
</ol>
<h2 id="与Struts2的区别"><a href="#与Struts2的区别" class="headerlink" title="与Struts2的区别"></a>与Struts2的区别</h2><p>它们两者的实现机制是不同的，所以说区分是很大的，主要是下面几点：</p>
<ul>
<li>SpringMVC 的入口是 Servlet，Struts2 是基于 Filter，所以就说它们的实现机制是不同的</li>
<li>SpringMVC 是基于方法的设计，也就是说传递参数是通过方法的形参，实现是单例（Spring 实例化对象默认就是单例），也推荐单例，这样就省去了创建、销毁对象的过程，提高效率，并且使用方法的形参传值，也不需要担心并发问题。<br>Struts2 是基于类设计，传递参数通过类的属性，只能设置为多例。</li>
<li>参数传递方面，Struts2 因为是用类属性接收，所以不同方法可以共享；但是在 SpringMVC 中多个方法直接不能共享参数，因为是基于方法的嘛</li>
</ul>
<h2 id="使用JSTL"><a href="#使用JSTL" class="headerlink" title="使用JSTL"></a>使用JSTL</h2><p>前面学过，JSTL 是个标签库，为什么要使用 JSTL 呢？SpringMVC 没有么？<br>答案是 SpringMVC 有自己的标签库，但是并没有 Struts2 的那么强大，所以就没有必要用它的了，使用经典成熟的 JSTL 或许是更好的选择。<br>在讲框架流程的时候也说了，最终模型里的数据会填充到 Request 域，所以 JSTL 可以直接获取数据来用的。<br>只要你还记得导 C 标签库和会用 JSTL 就行….</p>
<h2 id="输出-amp-输入为JSON"><a href="#输出-amp-输入为JSON" class="headerlink" title="输出&amp;输入为JSON"></a>输出&amp;输入为JSON</h2><p>在上一篇的 @ResponseBody 注解中提到了，使用了这个注解就意味着是不正常的输出（其他视图），默认就是 JSON。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/userlist"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">show</span> <span class="params">()</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>返回值是 List，<strong>当加入了 Jackson 的依赖后</strong>，会自动注册其对应的转换器，最终响应的就是 JSON 数据格式了，会自动把 List 对象序列化为 JSON 格式的数据。<br>当输入为 JSON 的时候就需要用 @RequestBody 来处理了，它们一个是从对象到 JSON，一个是 JSON 到对象（这里以 JSON 这种格式为例）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/user"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">show</span> <span class="params">(@RequestBody User user)</span> </span>&#123;...&#125;</span><br><span class="line"><span class="comment">// 获取原始 JSON 数据</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">show</span> <span class="params">(@RequestBody String user)</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>这个栗子就是接收一个 JSON 数据，然后反序列为 user 对象。</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>这里就用比较简单的方式了，Spring 自带的上传功能效率好像更好些，比较复杂，稍后再说；<br>首先要添加 Apache 的 commons-fileupload 依赖，上传功能依赖于它；然后在 SpringMVC 的配置文件中做相应的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 上传文件的设置 ，maxUploadSize=-1，表示无穷大。uploadTempDir为上传的临时目录 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">p:defaultEncoding</span>=<span class="string">"UTF-8"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">p:maxUploadSize</span>=<span class="string">"5400000"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">p:uploadTempDir</span>=<span class="string">"fileUpload/temp"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用了 p 命名空间，不记得？去看 spring 笔记二。可以配合 Spring 提供的 CharacterEncodingFilter 来简单处理下乱码问题。<br>如果怕出异常（如超出限制），可以配下 exceptionResolver 这个 bean。<br>然后定义处理上传文件的控制器即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span>(value=<span class="string">"/uploadfile"</span>,method=RequestMethod.GET)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">upLoadFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"upload"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span>(value=<span class="string">"/uploadfile"</span>,method=RequestMethod.POST)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">upLoadFile</span><span class="params">(@RequestParam(<span class="string">"file"</span>)</span> MultipartFile[] myfiles, HttpServletRequest request) <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//如果只是上传一个文件，则只需要MultipartFile类型接收文件即可</span></span><br><span class="line">    <span class="keyword">for</span>(MultipartFile myfile : myfiles) &#123;</span><br><span class="line">      <span class="keyword">if</span>(myfile.isEmpty()) &#123;</span><br><span class="line">        System.out.println(<span class="string">"文件未上传"</span>);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        System.out.println(<span class="string">"文件长度: "</span> + myfile.getSize()); </span><br><span class="line">        System.out.println(<span class="string">"文件类型: "</span> + myfile.getContentType()); </span><br><span class="line">        System.out.println(<span class="string">"文件名称: "</span> + myfile.getName()); </span><br><span class="line">        System.out.println(<span class="string">"文件原名: "</span> + myfile.getOriginalFilename()); </span><br><span class="line">        System.out.println(<span class="string">"==================="</span>); </span><br><span class="line"></span><br><span class="line">        String realPath = request.getSession().getServletContext().getRealPath(<span class="string">"/WEB-INF/upload"</span>);</span><br><span class="line">        <span class="comment">// FileUtils.copyInputStreamToFile() 会自动关流 </span></span><br><span class="line">        FileUtils.copyInputStreamToFile(myfile.getInputStream(), <span class="keyword">new</span> File(realPath + <span class="string">"/"</span> +myfile.getOriginalFilename()));</span><br><span class="line">        <span class="comment">// 或者使用下面的方式保存</span></span><br><span class="line">        <span class="comment">// myfile.transferTo(new File(realPath + "/" +myfile.getOriginalFilename()));</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"redirect:/success.html"</span>; </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到这些方法的返回值都是 String 类型的，根据前面所讲，对应的就是视图名了，如果字符串是以 redirect 开头，那就表示是以重定向的方式跳转到后面的地址。<br>然后，可以看到文件上传多数是通过 MultipartFile 这个对象来处理的，能够理解为什么前面在配置文件中配了个 MultipartResolver 解析器了吧。<br>Spring使用 Jakarta Commons FileUpload 技术实现了一个 MultipartResolver 实现类：CommonsMultipartResolver；<br>如果上传的是超大文件，还是使用流式传输比较好（使用 CommonsMultipartFile  对象来接收），虽然慢，但是省资源。<br>因为 <em>transferTo()</em> 函数调用 <em>write()</em> 函数，而这个函数要求上传文件已经要在内存中，或者是在磁盘里，才能成功执行。</p>
<h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h2><p>这一块的学习成本应该是比较低的，据说 SpringMVC 的拦截器思想来源就是 Struts2，所以应该差不多。<br>SpringMVC 拦截器接口（<strong>HandlerInterceptor</strong>）定义了三个方法：</p>
<ul>
<li>preHandle<br>该方法在目标方法之前被调用（调用 Handler 之前），在该方法中对用户请求 request 进行处理<br>若返回值为 true, 则继续调用后续的拦截器和目标方法.<br>若返回值为 false, 则不会再调用后续的拦截器和目标方法.<br>可以考虑做权限. 日志, 事务等。<br>方法中的 Object 对象，对于静态资源是 ResourceHttpRequestHandler 类型（一般都会进行排除不会拦截的）；对于动态资源是 HandlerMethod 类型，通过它可以获得 Method 等对象。</li>
<li>postHandle<br>调用目标方法之后, 但渲染视图之前.<br>可以对请求域中的属性或视图做出修改，也就是说：<br>这个方法在业务处理器处理完请求后，但是 DispatcherServlet 向客户端返回响应前被调用，在该方法中对用户请求 request 进行处理。</li>
<li>afterCompletion<br>渲染视图之后被调用（在 DispatcherServlet 完全处理完请求后）. 可用来释放资源</li>
</ul>
<p>自定义拦截器就不贴了，建个类，实现 HandlerInterceptor 接口就行了，就是上面的那三个方法，光写完了是没卵用的，还需要配置进 springmvc 的配置文件，这样它才知道你写了，然后才会执行（还记得框架流程图里的执行链？）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置自定义的拦截器，这样写所有请求都会生效 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.MySpringMVC.interceptors.FirstInterceptor"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 下面看比较理性的写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置拦截器作用的路径；/** 为所有请求 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/emps"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 若要配置不起作用的路径，则使用 &lt;mvc:exclude-mapping path=""/&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 如果使用了 @Component 注解，可以用 ref 来指定，id 默认类名首字母小写 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.MySpringMVC.interceptors.SecondInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>前面说过吧，<code>/**</code> 是指所有目录，也可以认为是所有请求了。<br>注意：即使配置了 mvc:resources 或者 mvc:default-servlet-handler 排除静态资源，但是除了视图（jsp、html）其他静态资源也会被拦截，需要再配置放行规则。</p>
<hr>
<p>然后下面就是重点的顺序问题，和 Struts 相似，preHandle 按照配置文件的顺序执行，剩余两个按照配置顺序的反序执行，应该能想得通吧。<br>工作流程（建议参考源码）：</p>
<ol>
<li>当页面发送请求后，DispatcherServlet 会通过其中的 HandlerExecutionChain 对象依次调用各拦截器的的 preHandle() 方法。<br>该 HandlerExecutionChain 对象，其中的 <strong>interceptors</strong> 属性记录了当前项目配置的所有拦截器，除了我们自定义的两个拦截器以外，还有一个 SpringMVC 内置的 ConversionServiceExposingInterceptor 拦截器。<br>此外，还有一个 int 型参数 <strong>interceptorIndex</strong> 用于记录当前时刻 preHandle() 方法已经返回 true 的拦截器的最大下标；<br>例如现在我们的 SecondInterceptor 拦截器的 preHandle() 方法返回了 false，那么 interceptorIndex 参数便为1，代表拦截器 ConversionServiceExposingInterceptor 和 FirstInterceptor 的 preHandle() 方法返回了 true</li>
<li>当 HandlerExecutionChain 对象发现某拦截器的 preHandle() 方法返回了 false 后，便执行 triggerAfterCompletion() 方法用于从下标值为 interceptorIndex 开始执行各拦截器的 <strong>afterCompletion()</strong> 方法，直到下标值减为 -1 为止<br>然后执行链直接 return，终止执行。</li>
<li>如果 HandlerExecutionChain 对象发现某拦截器的 preHandle() 方法返回的是 true ，那么会继续执行下一个的 preHandle，全部执行完后再执行 Handler 的具体逻辑</li>
<li>Handler 执行完毕后，开始倒序执行 postHandle() 各拦截器的后置方法</li>
<li>后置方法调用完成后开始渲染视图（利用 ModelAndView 对象），渲染完成后倒序调用拦截器的完成方法 afterCompletion()</li>
</ol>
<p>也就是说，无论第二个拦截器的 preHandle 返回的是什么，第一个（<strong>已经通过的拦截器</strong>）的 afterCompletion 都会执行；但是如果返回的是 false，Handler 和 postHandle 就不会执行了。</p>
<blockquote>
<p>和过滤器的区别：<br>简单来说，过滤器什么都能拦下来，而拦截器则不一定，看框架的实现，比如 SpringMVC 的拦截器就不拦视图。<br>其次，过滤器是 Servlet API 里的，其中不能注入 Spring IoC 的对象；拦截器是 Spring 自己的（SpringMVC 中），就可以使用了。</p>
</blockquote>
<h2 id="使用RESTful"><a href="#使用RESTful" class="headerlink" title="使用RESTful"></a>使用RESTful</h2><p>前面最开始的时候页介绍了，SpringMVC 支持 RESTful 风格，原来是使用 @ResponseBody 注解来转成相关的 json 格式，其实不需要这么的复杂。<br>这里必须要说下 <code>ResponseEntity&lt; T&gt;</code> 这个对象了:</p>
<blockquote>
<p>ResponseEntity 意味着表示整个 HTTP 响应。你可以控制任何进入它：状态码，标题和正文。<br>@ResponseBody 是 HTTP 响应正文的标记，@ResponseStatus 声明 HTTP 响应的状态代码。</p>
</blockquote>
<p>来看几个栗子就知道是怎么回事了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"rest/girl"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestfulController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(RestfulController.class);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Resource</span></span><br><span class="line">  <span class="keyword">private</span> GirlService girlService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span>(value = <span class="string">"&#123;id&#125;"</span>, method = RequestMethod.GET)</span><br><span class="line">  <span class="meta">@ResponseBody</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> ResponseEntity&lt;Girl&gt; <span class="title">getGirl</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">    LOGGER.info(<span class="string">"-----------------&gt;"</span> + id);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Girl girl = girlService.queryGirl(id);</span><br><span class="line">      <span class="keyword">if</span> (girl == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NOT_FOUND).body(<span class="keyword">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 200 可以进行简写</span></span><br><span class="line">      <span class="keyword">return</span> ResponseEntity.ok(girl);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(<span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span>(method = RequestMethod.POST)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">saveGirl</span><span class="params">(Girl girl)</span> </span>&#123;</span><br><span class="line">    LOGGER.debug(<span class="string">"--------------&gt;"</span> + girl.getName());</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (girl.getName().isEmpty() || girl.getAge().toString().isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// 400 错误，参数不正确</span></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST).build();</span><br><span class="line">      &#125;</span><br><span class="line">      Boolean flag = girlService.saveGirl(girl);</span><br><span class="line">      <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">        <span class="comment">// 新增成功，响应 201,如果返回是 void 可以使用 build 方法</span></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).build();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 新增失败</span></span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span>(method = RequestMethod.PUT)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">updateGirl</span><span class="params">(Girl girl)</span> </span>&#123;</span><br><span class="line">    LOGGER.debug(<span class="string">"--------------&gt;"</span> + girl.getName());</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (girl.getName().isEmpty() || girl.getId().toString().isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// 400 错误，参数不正确</span></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST).build();</span><br><span class="line">      &#125;</span><br><span class="line">      Boolean flag = girlService.updateGirl(girl);</span><br><span class="line">      <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">        <span class="comment">// 修改成功，响应 204,如果返回是 void 可以使用 build 方法</span></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NO_CONTENT).build();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 新增失败</span></span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span>(method = RequestMethod.DELETE)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">deleteGirl</span><span class="params">(@RequestParam(value = <span class="string">"id"</span>,defaultValue = <span class="string">"0"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (id == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST).build();</span><br><span class="line">      &#125;</span><br><span class="line">      Boolean flag = girlService.deleteGirl(id);</span><br><span class="line">      <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">        <span class="comment">// 删除成功，响应 204</span></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NO_CONTENT).build();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 新增失败</span></span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回的时候会自动把实体里的属性（凡是有 getter 方法的）转换成 JSON 类型的格式(默认)返回，同时可以设置状态码之类的，总之就是非常的全面了，先说这些，等以后再补充。</p>
<p>其他相关的注解：</p>
<ul>
<li>@RestController：<br>Spring 4 的新注解。 她自动为每个方法加上 @ResponseBody ；<br>@RestController 可以看做是 @Controller 和@ResponseBody 两个注解的组合。</li>
<li>@RequestBody：<br>如果一个方法申明了 @RequestBody 注解, Spring 会基于请求头中的 Content-Type 使用 HTTP Message converters 将 request body 反序列化成对象。</li>
<li>@ResponseBody：<br>是在方法的上注解，如果一个方法申明了@ResponseBody, Spring 会基于请求头中的 Accept 使用 HTTP Message converters 将对象序列化成 response body。<br>在 Spring 4 中如果使用了 @RestController，则可以不用再声明此注解。</li>
</ul>
<h2 id="关于父-子容器"><a href="#关于父-子容器" class="headerlink" title="关于父/子容器"></a>关于父/子容器</h2><p>当我们的项目中引入了 Spring + SpringMVC 后，在启动后其实有两个 Spring 容器，一个是 Spring 的容器（处理 Bean），一个是 SpringMVC 的容器（处理 Controller），它们是父子关系，Spring 就是父容器了！<br>它们的关系：</p>
<ul>
<li><strong>子容器能够访问父容器的资源（Bean）</strong><br>比如说在 Controller 中可以引用（注入） Service 中的 Bean</li>
<li><strong>父容器不能访问子容器中的资源</strong><br>这也就说明了为什么在 Spring 的配置文件中配置了扫描包，而在 SpringMVC 的配置文件中却还要再配置</li>
</ul>
<p>然后再说下 @Value 这个注解，<strong>它就是用来获取配置文件中的值的</strong>；时机就是在所有 Bean 初始完成后从<strong>当前所在容器中</strong>获取值，然后注入；所以说如果在 Controller 中使用可能获取不到（假设配置在 Spring 文件中读取），即使子容器能够访问父容器，但是优先级最高的还是注解自身的特性。<br>解决方案可以采用在 Service 中写一个 <strong>propertiesService</strong> 专门用来注入配置文件的值，然后在 Controller 中注入这个 Service 来间接的使用配置文件中的值。<br>在它们整合的时候，SpringMVC 其实会扫描是否存在 Spring 容器（存在 Application 域，所以还算好找），如果存在就把它作为父容器，如果不存在它会自己搞一个（具体不是很清楚）</p>
<h2 id="路径匹配"><a href="#路径匹配" class="headerlink" title="路径匹配"></a>路径匹配</h2><p>在 SpringMVC 中遵循：路径匹配，先最长路径匹配，再最短路径匹配；优先级最高的精确匹配就不说了。<br>所以说 <code>/*</code> 可以匹配所有，如果设置为 <code>&lt;url-pattern&gt;/user/*&lt;/url-pattern&gt;</code> 那么 <code>/abc/def/user/list</code> 也是可以匹配到的，我想说明的就是这个，在以前的文章中应该提到过，不过我没找到呢。</p>
<h2 id="关于放行静态资源"><a href="#关于放行静态资源" class="headerlink" title="关于放行静态资源"></a>关于放行静态资源</h2><p>当 SpringMVC 拦截 <code>/</code> 的时候，会拦截所有请求，这时候需要配置让其放行静态资源，方式有几种：</p>
<ul>
<li>激活Tomcat的defaultServlet来处理静态文件</li>
<li>XML 中使用 <strong>mvc:resources</strong> 标签</li>
<li>XML 中使用 <strong>mvc:default-servlet-handler</strong> 标签</li>
</ul>
<p>对于方案一，要写在 DispatcherServlet 的前面， 让 defaultServlet 先拦截，这个就不会进入 Spring 了：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>     </span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>    </span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.jpg<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>       </span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>      </span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>         </span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>      </span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.js<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>      </span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>      </span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>          </span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>         </span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.css<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>        </span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>关于默认 servlet 是专门处理静态资源的，名字也不是乱写的：</p>
<blockquote>
<p>Tomcat, Jetty, JBoss, and GlassFish  默认 Servlet的名字 – “default”<br>Google App Engine 默认 Servlet的名字 – “_ah_default”<br>Resin 默认 Servlet的名字 – “resin-file”<br>WebLogic 默认 Servlet的名字  – “FileServlet”<br>WebSphere  默认 Servlet的名字 – “SimpleFileServlet”</p>
</blockquote>
<hr>
<p>方案二配置：<code>&lt;mvc:resources mapping=&quot;/images/**&quot; location=&quot;/images/&quot; /&gt;</code></p>
<ul>
<li>location 指定静态资源的位置，可以是 web application 根目录下、jar 包里；多个路径可使用 <code>,</code> 分割</li>
<li>mapping 指的是 location 映射成的路径，前端请求访问的就是这个路径，<code>**</code> 表示的是包含多层目录。</li>
</ul>
<p><strong>由 Spring MVC 框架自己处理静态资源</strong>，并添加一些有用的附加值功能。</p>
<blockquote>
<p> <code>&lt;mvc:resources /&gt;</code> 允许静态资源放在任何地方，如 WEB-INF 目录下、类路径下等，你甚至可以将JavaScript等静态文件打到JAR包中。<br>通过 location 属性指定静态资源的位置，由于location属性是Resources类型，因此可以使用诸如”classpath:”等的资源前缀指定资源位置。<br>传统 Web 容器的静态资源只能放在 Web 容器的根路径下，<code>&lt;mvc:resources /&gt;</code> 完全打破了这个限制。 </p>
<p>其次，<code>&lt;mvc:resources /&gt;</code> 依据当前著名的 Page Speed、YSlow 等浏览器优化原则对静态资源提供优化。你可以通过cacheSeconds属性指定静态资源在浏览器端的缓存时间，一般可将该时间设置为一年，以充分利用浏览器端的缓存。在输出静态资源时，会根据配置设置好响应报文头的Expires 和 Cache-Control值。<br>在接收到静态资源的获取请求时，会检查请求头的Last-Modified值，如果静态资源没有发生变化，则直接返回303相应状态码，提示客户端使用浏览器缓存的数据，而非将静态资源的内容输出到客户端，以充分节省带宽，提高程序性能 。</p>
</blockquote>
<hr>
<p>方案三是用的最多的一种，<strong>将静态资源的处理经由 Spring MVC 框架交回Web应用服务器处理</strong> 。<br>定义此标签后，会在 Spring MVC 上下文中定义一个 <code>org.springframework.web.servlet.resource.DefaultServletHttpRequestHandler</code>，它会像一个检查员，对进入 DispatcherServlet 的 URL 进行筛查，如果发现是静态资源的请求，就将该请求转由 Web 应用服务器默认的 Servlet 处理，如果不是静态资源的请求，才由 DispatcherServlet 继续处理。<br>一般 Web 应用服务器默认的 Servlet 名称是 “default”，因此 DefaultServletHttpRequestHandler 可以找到它。如果你所有的 Web 应用服务器的默认 Servlet 名称不是 “default”，则需要通过 default-servlet-name 属性显示指定：<br><code>&lt;mvc:default-servlet-handler default-servlet-name=&quot;所使用的Web服务器默认使用的 Servlet 名称&quot; /&gt;</code></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>接收数据时用到日期时，默认 SpringMVC 是不会处理的，如果使用的是 po 来接收，那么肯定会转换异常，这时可以使用 <code>@DateTimeFormat</code> 注解来格式化，它有一个 pattern 参数可以指定日期的格式，比如：<code>@DateTimeFormat(pattern=&quot;yyyy-MM-dd&quot;)</code><br>类似的，SpringMVC 提供其他多个 format，比如 NumberFormat 需要时了解吧</p>
<hr>
<p>如果只是简单的跳转视图逻辑，那么可以使用 <code>&lt;mvc:view-controller path=&quot;&quot; view-name=&quot;&quot;/&gt;</code> 来配置，省的单独写一个 controller 方法了。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.cnblogs.com/fangjian0423/p/springMVC-interceptor.html" target="_blank" rel="noopener">http://www.cnblogs.com/fangjian0423/p/springMVC-interceptor.html</a><br><a href="http://blog.csdn.net/xiangwanpeng/article/details/53157756" target="_blank" rel="noopener">http://blog.csdn.net/xiangwanpeng/article/details/53157756</a><br><a href="http://www.jianshu.com/p/58cf4936c523" target="_blank" rel="noopener">http://www.jianshu.com/p/58cf4936c523</a><br><a href="https://www.cnblogs.com/fangqi/archive/2012/10/28/2743108.html" target="_blank" rel="noopener">https://www.cnblogs.com/fangqi/archive/2012/10/28/2743108.html</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>喜欢就请我吃包辣条吧！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/image/pay/wx.jpg" alt="Kerronex WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/image/pay/zfb.jpg" alt="Kerronex Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>本文作者：</strong>
      Kerronex
    </li>
    <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://sakanoy.com/2017/10/06/SpringMVC学习笔记（二）/" title="SpringMVC学习笔记（二）">https://sakanoy.com/2017/10/06/SpringMVC学习笔记（二）/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明： </strong>
      本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
    </li>
  </ul>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
          
            <a href="/tags/SpringMVC/" rel="tag"><i class="fa fa-tag"></i> SpringMVC</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/10/05/SpringMVC学习笔记/" rel="next" title="SpringMVC学习笔记">
                <i class="fa fa-chevron-left"></i> SpringMVC学习笔记
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/10/11/SSM框架整合简述/" rel="prev" title="SSM框架整合简述">
                SSM框架整合简述 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        
          <p class="warninginfo">
            <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
              评论框加载失败，无法访问 Disqus<br><br>
              你可能需要魔法上网~~
          </p>

      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/image/tx.png"
               alt="Kerronex" />
          <p class="site-author-name" itemprop="name">Kerronex</p>
           
              <p class="site-description motion-element" itemprop="description">程序猿/二刺螈<br/>夜猫族/爱折腾</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">130</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">75</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="Mailto:bfchengnuo@gmail.com" target="_blank" title="Email">
                  
                    <i class="fa fa-fw fa-envelope-o"></i>
                  
                  Email
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://GitHub.com/bfchengnuo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://sakanoy.com/MyRecord/#/" target="_blank" title="笔记本">
                  
                    <i class="fa fa-fw fa-book"></i>
                  
                  笔记本
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cnblogs.com/bfchengnuo" target="_blank" title="博客园">
                  
                    <i class="fa fa-fw fa-paw"></i>
                  
                  博客园
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              小伙伴们~
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://heartsky.info" title="HeartSky" target="_blank">HeartSky</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.kiuber.me" title="Kiuber" target="_blank">Kiuber</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/nightcharm" title="夜Charm" target="_blank">夜Charm</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#深入RequestMapping"><span class="nav-number">1.</span> <span class="nav-text">深入RequestMapping</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#支持的方法参数"><span class="nav-number">1.1.</span> <span class="nav-text">支持的方法参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#支持的返回类型"><span class="nav-number">1.2.</span> <span class="nav-text">支持的返回类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#与Struts2的区别"><span class="nav-number">2.</span> <span class="nav-text">与Struts2的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用JSTL"><span class="nav-number">3.</span> <span class="nav-text">使用JSTL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出-amp-输入为JSON"><span class="nav-number">4.</span> <span class="nav-text">输出&amp;输入为JSON</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件上传"><span class="nav-number">5.</span> <span class="nav-text">文件上传</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拦截器"><span class="nav-number">6.</span> <span class="nav-text">拦截器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用RESTful"><span class="nav-number">7.</span> <span class="nav-text">使用RESTful</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关于父-子容器"><span class="nav-number">8.</span> <span class="nav-text">关于父/子容器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路径匹配"><span class="nav-number">9.</span> <span class="nav-text">路径匹配</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关于放行静态资源"><span class="nav-number">10.</span> <span class="nav-text">关于放行静态资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他"><span class="nav-number">11.</span> <span class="nav-text">其他</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">12.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>
    <div style="height: 370px;background-image: url(/image/bj.png);background-repeat: no-repeat; margin-left: 31%;"></div>
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
<span id="sitetime"></span>
<span class="my-face">(●'◡'●)ﾉ♥</span>
<script language=javascript>
function siteTime(){
window.setTimeout("siteTime()", 1000);
var seconds = 1000
var minutes = seconds * 60
var hours = minutes * 60
var days = hours * 24
var years = days * 365

var today = new Date()
var todayYear = today.getFullYear()
var todayMonth = today.getMonth()
var todayDate = today.getDate()
var todayHour = today.getHours()
var todayMinute = today.getMinutes()
var todaySecond = today.getSeconds()

/* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳) 
year - 作为date对象的年份，为4位年份值
month - 0-11之间的整数，做为date对象的月份
day - 1-31之间的整数，做为date对象的天数
hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
minutes - 0-59之间的整数，做为date对象的分钟数
seconds - 0-59之间的整数，做为date对象的秒数
microseconds - 0-999之间的整数，做为date对象的毫秒数 */
var t1 = Date.UTC(2016,3,30,8,0,0)
var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond)
var diff = t2-t1

var diffYears = Math.floor(diff/years)
var diffDays = Math.floor((diff/days)-diffYears*365)
var diffDaysAll = Math.floor(diff/days)
var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours)
var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes)
var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds)
document.getElementById("sitetime").innerHTML=" 本站已萌萌哒运行 "+diffDaysAll+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒 "
}
siteTime()
</script>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共521.4k字</span>

</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'bfchengnuo';
      var disqus_identifier = '2017/10/06/SpringMVC学习笔记（二）/';

      var disqus_title = "SpringMVC学习笔记（二）";


      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      

      
        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
            this.page.title = disqus_title;
        };
        run_disqus_script('embed.js');
      

    </script>
  













  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":130,"height":170,"hOffset":30,"vOffset":-10},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body>
</html>
